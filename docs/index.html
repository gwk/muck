<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
 <title>index.html</title>
 <meta name="description" content="" />
 <meta name="author" content="" />
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=" />
  <style type="text/css">
a { background-color: transparent; }
a:active { outline: 0; }
a:hover { outline: 0; }
a:link { color: #1010A0; }
a:visited { color: #301080; border-bottom: 3px solid; }
blockquote { border-left-color: #E0E0E0; border-left-style: solid; border-left-width: 0.333rem; margin: 0; padding: 0 0.667rem; }
body { margin: 0 auto; max-width: 64rem; border: transparent solid 0.5rem; }
body footer { border-top-color: #E8E8E8; border-top-style: solid; border-top-width: 1px; color: #606060; font-size: .875rem; margin: 1rem 0 0 0; }
code { font-family: source code pro, terminal, monospace; }
code.inline { background-color: #F0F0F0; border-color: #D0D0D0; border-radius: 2px; border-style: solid; border-width: 0.5px; overflow-wrap: break-word; white-space: pre-wrap; }
code.line { display: block; margin: 0; overflow-wrap: break-word; padding: 0 0 0 0.5rem; text-indent: -0.5rem; white-space: pre-wrap; }
div.code-block { background-color: #F8F8F8; border-color: #D0D0D0; border-radius: 4px; border-style: solid; border-width: 0.5px; font-size: 1rem; margin: 1rem 0; padding: 0.1rem; }
div.embed-label { background-color: #FFFFFF; border-bottom-style: none; border-color: #E0E0E0; border-style: solid solid none solid; border-top-left-radius: 4px; border-top-right-radius: 4px; border-width: 0.5px; color: #404040; display: inline-block; font-family: source code pro, terminal, monospace; font-size: 0.8rem; margin-top: 1rem; }
div.embed-label + * { border-top-left-radius: 0; margin-top: 0.5px; }
footer { display: block; }
h1 { font-size: 1.8rem; margin: 0.9rem 0; }
h2 { font-size: 1.6rem; margin: 0.8rem 0; }
h3 { font-size: 1.4rem; margin: 0.7rem 0; }
h4 { font-size: 1.3rem; margin: 0.65rem 0; }
h5 { font-size: 1.2rem; margin: 0.6rem 0; }
h6 { font-size: 1.1rem; margin: 0.55rem 0; }
header { display: block; }
html { background: white; color: black; font-family: source sans pro, sans-serif; font-size: 1rem; }
nav { display: block; }
p { margin: 0.5rem 0; }
section { display: block; }
section.S1 { border-top-color: #E8E8E8; border-top-style: solid; border-top-width: 1px; margin: 1.8rem 0; }
section.S2 { margin: 1.6rem 0; }
section.S3 { margin: 1.4rem 0; }
section.S4 { margin: 1.3rem 0; }
section.S5 { margin: 1.2rem 0; }
section.S6 { margin: 1.1rem 0; }
section#s0 { border-top-width: 0; }
table { background: #F0F0F0; border-radius: 4px; border: #D0D0D0 0.5px solid; }
table th { padding: 0.25rem 0.25rem; }
table th:first-child { padding-left: 0.25rem; text-align: left; }
table td { background: #FAFAFA; font-family: monospace; padding:0.25rem; white-space: pre; }
table td:first-child { border-left: 0; padding-left: 0.25rem; text-align: left; }
table tr { padding-left: 0.25rem; text-align: left; }
table tr:last-child td { border-bottom: 0; }
table tr:last-child td:first-child { border-bottom-left-radius: 2px; }
table tr:last-child td:last-child { border-bottom-right-radius: 2px; }
table tr:nth-child(odd) td { background: #FFFFFF; }
table tr:nth-child(even) td { background: #FBFBFB; }
table tr:hover td { background: #F0F0F0; }
ul { line-height: 1.333rem; list-style-position: outside; list-style-type: disc; margin-left: 1rem; padding-left: 0.1rem; }
@media print { @page { margin: 2cm; }
}
  </style>
  <script type="text/javascript"> "use strict";
function scrollToElementId(id) {
  window.scrollTo(0, document.getElementById(id).offsetTop);
}

var in_pres_mode = false;
function togglePresentationMode() {
  in_pres_mode = !in_pres_mode;
  for (var sid of paging_ids) {
    var section = document.getElementById(sid);
    if (section.id == 'body') {
      // skip; not actually a section.
    } else {
      section.style['margin'] = in_pres_mode ? '100vh 0 0 0' : '0';
    }
  }
  var footer = document.getElementById('footer');
  footer.style['margin'] = in_pres_mode ? '100vh 0 0 0' : '0';
}

var section_ids = null;
var paging_ids = null;
var paging_idx = 0;

window.onkeydown = function(e) {
  if (e.keyCode === 37) { // left.
    if (paging_idx > 0) {
      paging_idx -= 1;
    }
    scrollToElementId(paging_ids[paging_idx]);
  } else if (e.keyCode === 39) { // right.
    if (paging_idx < paging_ids.length - 1) {
      paging_idx += 1;
    }
    scrollToElementId(paging_ids[paging_idx]);
  }
};

window.onkeypress = function(e) {
  if (e.charCode === 112) { // 'p'.
    togglePresentationMode();
  }
};
</script>
</head>
<body id="body">
<section class="S1" id="s0">
  <h1 id="h0">Muck</h1>
  <p>
    Muck is a build tool for data analysis projects. Given a target (a file to be built), it looks in the current directory tree for a source file with a matching name, determines its static dependencies, recursively builds those, and then builds the target, possibly building additional dynamic dependencies as necessary. For example, if we ask Muck to build <code class="inline">some.txt</code>, it will run any source file with <code class="inline">some.txt</code> as a prefix, e.g. <code class="inline">some.txt.py</code>, <code class="inline">some.txt.sh</code>, or <code class="inline">some.txt.md</code> (there must be a single source candidate). If <code class="inline">some.txt.py</code> opens <code class="inline">data.txt</code>, Muck will suspend the execution of the process and update <code class="inline">data.txt</code>.
  </p>
  <p>
    Unlike Make and other traditional build systems, Muck does not use a "makefile". Instead, Muck determines the dependencies of a given file using static analysis and runtime interposition of the Unix <code class="inline">open</code> system call. With Muck, programmers can organize projects into discrete steps with arbitrary file dependencies between them. When the source code for a particular step changes, Muck will rebuild that step and all dependent ("downstream") steps, but will not redo any work that is not affected by the change. This incremental rebuild behavior speeds up the development process and helps prevent errors due to stale product files.
  </p>
  <p>
    Muck is most useful for projects where the various products can be given descriptive, discrete names. It is less useful for problems that can be framed as processing a continuous stream of inputs; these are better served by an application server.
  </p>
  <section class="S2" id="s0.1">
    <h2 id="h0.1">Getting Started</h2>
    <p>
      Muck is a work in progress. I encourage people to try it out, with the caveat that it is not yet entirely stable. If you run into issues, I am more than happy to help you work through them. The project is hosted at <a href="https://github.com/gwk/muck">https://github.com/gwk/muck</a>, with documentation at <a href="https://gwk.github.io/muck">https://gwk.github.io/muck</a>. To get started, read the "Installation" section.
    </p>
  </section>
  <section class="S2" id="s0.2">
    <h2 id="h0.2">License</h2>
    <p>
      All of the source code and documentation is dedicated to the public domain under CC0: <a href="https://creativecommons.org/.publicdomain/zero/1.0/">https://creativecommons.org/.publicdomain/zero/1.0/</a>.
    </p>
  </section>
  <section class="S2" id="s0.3">
    <h2 id="h0.3">Status</h2>
    <p>
      Muck is still in development. Currently it only runs on Mac OS, but Linux support is coming soon. It has been used for a variety of experimental projects, but more work is needed to make it production-ready. In particular, Linux support has recently fallen behind, and the test suite and documentation need improvement.
    </p>
  </section>
  <section class="S2" id="s0.4">
    <h2 id="h0.4">Issues</h2>
    <p>
      Please file any bugs, questions, or comments at <a href="https://github.com/gwk/muck/issues">https://github.com/gwk/muck/issues</a>.
    </p>
  </section>
</section>
<section class="S1" id="s1">
  <h1 id="h1">Installation</h1>
  <section class="S2" id="s1.1">
    <h2 id="h1.1">Python 3.6</h2>
    <p>
      Muck requires Python 3.6. (In the future it will support running project scripts in any available version).
    </p>
    <ul class="L1">
      <li>macOS: install from http://python.org, or use Homebrew. You will end up with multiple versions of Python on the system, so make sure that the <code class="inline">python3</code> and <code class="inline">pip3</code> that you are using are what you think they are. <code class="inline">python3&nbsp;--version</code> and <code class="inline">pip3&nbsp;--version</code>. You can also use <code class="inline">python3.6</code> and <code class="inline">pip3.6</code> (or a later version) if you do not want to change your default installation.</li>
    </ul>
  </section>
  <section class="S2" id="s1.2">
    <h2 id="h1.2">Git</h2>
    <p>
      To install the latest revision of Muck:
    </p>
<div class="code-block">
<code class="line">cd external # Or whatever directory you like to check out code.</code>
<code class="line">git clone git@github.com:gwk/muck.git # Clones the Muck repository.</code>
<code class="line">muck/update-subs.sh # Check out Muck's dependencies as git submodules.</code>
<code class="line">pip3 install -e muck # Install Muck from the repository in editable/development mode. Substitute `pip3.6` or other as appropriate.</code>
</div>
  </section>
  <section class="S2" id="s1.3">
    <h2 id="h1.3">Pip</h2>
    <p>
      Muck is available via the Python Package Index (PyPI), but due to ongoing development the published version is often out of date. Once Muck enters a more stable phase of development, users should install with <code class="inline">pip3&nbsp;install&nbsp;muck</code>.
    </p>
  </section>
  <section class="S2" id="s1.4">
    <h2 id="h1.4">Troubleshooting</h2>
    <p>
      Once installed, <code class="inline">muck</code> should be available on the command line. If it is not, it may be that the <code class="inline">PATH</code> environment variable in your shell is not configured to point to console scripts installed by pip. Please open an issue and I am happy to help get you started.
    </p>
  </section>
</section>
<section class="S1" id="s2">
  <h1 id="h2">Usage</h1>
  <p>
    <code class="inline">muck</code> takes a list of targets as command line arguments. If no targets are provided it defaults to <code class="inline">index.html</code>.
  <br />
    Given a target <code class="inline">dir/stem.ext</code>, muck tries to produce the target file using the following steps:
  </p>
  <ul class="L1">
    <li>If the target exists as named in the project directory, then it does nothing.</li>
    <li>If a source file exists that consists of the whole target name plus an extension, e.g. <code class="inline">dir/stem.ext.py</code>, then that file is executed and its standard output is written to <code class="inline">_build/dir/stem.ext</code>.</li>
    <li>If a matching source file exists with multiple extensions, e.g. 'dir/stem.ext.py.py', then that file is executed to produce a new source file <code class="inline">dir/stem/ext.py</code>, and the resulting product is then executed as a source file.</li>
    <li>Otherwise Muck issues an error.</li>
  </ul>
  <p>
    When a script is run, it is first analyzed by Muck for any static dependencies, which will be updated before running the script. Dependency analysis is limited to source languages that Muck understands. Additionally, Muck intercepts calls to <code class="inline">open</code> at the OS level, using DYLD_INSERT_LIBRARIES on macOS and eventually LD_PRELOAD on Linux. This information is used to calculate a complete dependency graph for arbitrary processes on the fly.
  </p>
</section>
<section class="S1" id="s3">
  <h1 id="h3">An Example</h1>
  <p>
    Suppose we want to produce a document that contains two charts, A and B. Each of these is derived from some data that we scrape from the web. A typical Muck project to achieve this would consist of four files:
  </p>
  <ul class="L1">
    <li><code class="inline">document.html.wu</code>, referencing <code class="inline">chartA.svg</code> and <code class="inline">chartB.svg</code>.</li>
    <li><code class="inline">chartA.svg.py</code>, referencing <code class="inline">data.csv</code>.</li>
    <li><code class="inline">chartB.svg.py</code>, referencing <code class="inline">data.csv</code>.</li>
    <li><code class="inline">data.csv.py</code>.</li>
  </ul>
  <p>
    This project has a dependency graph whose shape is essentially a diamond, with <code class="inline">document.html</code> at the root, and <code class="inline">data.csv.py</code> having no dependencies. Note that <code class="inline">.wu</code> files indicate a markup format called <a href="https://gwk.github.io/writeup">Writeup</a>, similar to Markdown. Markdown support is in progress.
  </p>
  <p>
    The programmer can build the document by invoking <code class="inline">muck&nbsp;document.html</code> on the command line. Muck will then take the following steps:
  </p>
  <ul class="L1">
    <li><code class="inline">document.html</code>: does not exist; infer source: <code class="inline">document.html.wu</code>.</li>
    <li><code class="inline">document.html.wu</code>: analyze, discover dependencies: <code class="inline">chartA.svg</code>, <code class="inline">chartB.svg</code>.</li>
    <li><code class="inline">chartA.svg</code>: does not exist; infer source: <code class="inline">chartA.svg.py</code>.</li>
    <li><code class="inline">chartA.svg.py</code>: analyze, discover dependencies: <code class="inline">data.csv</code>.</li>
    <li><code class="inline">data.csv</code>: does not exist; infer source: <code class="inline">data.csv.py</code>.</li>
    <li>
      <p>
        <code class="inline">data.csv.py</code>:
      </p>
      <ul class="L2">
        <li>analyze; no dependencies.</li>
        <li>run <code class="inline">python3&nbsp;data.csv.py</code>, writing stdout to <code class="inline">_build/data.csv</code>.</li>
      </ul>
    </li>
    <li>
      <p>
        <code class="inline">chartA.svg.py</code>:
      </p>
      <ul class="L2">
        <li>run <code class="inline">python3&nbsp;chartA.svg.py</code>, which reads <code class="inline">_build/data.csv</code> and writes stdout to <code class="inline">_build/chartA.svg</code>.</li>
      </ul>
    </li>
    <li><code class="inline">chartB.svg</code>: does not exist; infer source: <code class="inline">chartB.svg.py</code>.</li>
    <li>
      <p>
        <code class="inline">chartB.svg.py</code>:
      </p>
      <ul class="L2">
        <li>analyze, discover dependencies: <code class="inline">data.csv</code>.</li>
        <li>run <code class="inline">python3&nbsp;chartB.svg.py</code>, which reads <code class="inline">_build/data.csv</code> and writes stdout to <code class="inline">_build/chartB.svg</code>.</li>
      </ul>
    </li>
    <li>
      <p>
        <code class="inline">document.html</code>:
      </p>
      <ul class="L2">
        <li>run <code class="inline">writeup&nbsp;document.html.wu</code>, which reads <code class="inline">_build/chartA.svg</code>, <code class="inline">_build/chartB.svg</code>, and writes <code class="inline">_build/document.html</code>.</li>
      </ul>
    </li>
  </ul>
</section>
<section class="S1" id="s4">
  <h1 id="h4">Demos</h1>
  <ul class="L1">
    <li><a href="https://gwk.github.io/muck/demos/oecd-health">OECD health data</a>: this tutorial shows a how to build a complete article in Muck, in notebook style that interleaves prose, code, and results.</li>
  </ul>
</section>
<section class="S1" id="s5">
  <h1 id="h5">Credits</h1>
  <p>
    Muck is developed by <a href="https://gwk.github.io">George King</a>, and was initially sponsored by the <a href="https://towcenter.org">Tow Center for Digital Journalism</a>. Professor <a href="https://journalism.columbia.edu/faculty/mark-hansen">Mark Hansen</a> and the <a href="https://brown.columbia.edu/about/">Brown Institute</a> have supported this research since it began in 2015. <a href="https://massivesci.com/people/gabe-stein">Gabe Stein</a> has collaborated on design and testing.
  </p>
</section>
<script type="text/javascript"> "use strict";
section_ids = ['s0','s0.1','s0.2','s0.3','s0.4','s1','s1.1','s1.2','s1.3','s1.4','s2','s3','s4','s5'];
paging_ids = ['body', 's0','s0.1','s0.2','s0.3','s0.4','s1','s1.1','s1.2','s1.3','s1.4','s2','s3','s4','s5'];
</script>
<footer id="footer">
Dedicated to the public domain under CC0: https://creativecommons.org/publicdomain/zero/1.0/.
</footer>
</body>
</html>
