<html>
<head>
  <meta charset="utf-8">
  <title>doc/index.html.wu</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
  <style type="text/css">a { background-color: transparent; } a:active { outline: 0; } a:hover { outline: 0; } blockquote { border-left-color: #E0E0E0; border-left-style: solid; border-left-width: 0.333rem; margin: 0; padding: 0 0.677rem; } body { margin: 1rem; } body footer { border-top-color: #E8E8E8; border-top-style: solid; border-top-width: 1px; color: #606060; font-size: .875rem; margin: 1rem 0 0 0; } code { background-color: rgb(240, 240, 240); border-radius: 3px; font-family: source code pro, menlo, terminal, monospace; } footer { display: block; } h1 { font-size: 1.6rem; margin: 0.8rem 0; } h2 { font-size: 1.4rem; margin: 0.7rem 0; } h3 { font-size: 1.3rem; margin: 0.6rem 0; } h4 { font-size: 1.2rem; margin: 0.5rem 0; } h5 { font-size: 1.1rem; margin: 0.4rem 0; } h6 { font-size: 1.0rem; margin: 0.3rem 0; } header { display: block; } html { background: white; color: black; font-family: source sans pro, sans-serif; font-size: 1rem; } nav { display: block; } p { margin: 0.5rem 0; } pre { background: #F0F0F0; font-family: source code pro, menlo, terminal, monospace; font-size: 1rem; overflow: auto; padding: 0.1rem; border-radius: 4px; } section { display: block; } section.S1 { border-top-color: #E8E8E8; border-top-style: solid; border-top-width: 1px; margin: 1.6rem 0; } section.S2 { margin: 1.4rem 0; } section.S3 { margin: 1.3rem 0; } section.S4 { margin: 1.2rem 0; } section.S5 { margin: 1.1rem 0; } section.S6 { margin: 1.0rem 0; } section#s1 { border-top-width: 0; } table { font-family: sans-serif; color:#666; background:#eaebec; margin:16px; border:#ccc 1px solid; border-radius:3px; box-shadow: 0 1px 2px #d1d1d1; } table th { padding:20px 24px 20px 24px; border-top:1px solid #fafafa; border-bottom:1px solid #e0e0e0; background: #ededed; } table th:first-child { text-align: left; padding-left:20px; } table tr:first-child th:first-child { border-top-left-radius:3px; } table tr:first-child th:last-child { border-top-right-radius:3px; } table tr { text-align: left; padding-left:20px; } table td:first-child { text-align: left; padding-left:20px; border-left: 0; } table td { padding:8px; border-top: 1px solid #ffffff; border-bottom:1px solid #e0e0e0; border-left: 1px solid #e0e0e0; background: #fafafa; } table tr.even td { background: #f6f6f6; } table tr:last-child td { border-bottom:0; } table tr:last-child td:first-child { border-bottom-left-radius:3px; } table tr:last-child td:last-child { border-bottom-right-radius:3px; } table tr:hover td { background: #f2f2f2; } ul { line-height: 1.333rem; list-style-position: inside; list-style-type: disc; margin: 0rem; padding-left: 0.1rem; } ul > ul { padding-left: 1.1rem; } @media print { @page { margin: 2cm; } }</style>
  <script type="text/javascript"> "use strict";
function scrollToElementId(id) {
  window.scrollTo(0, document.getElementById(id).offsetTop);
}

var in_pres_mode = false;
function togglePresentationMode() {
  in_pres_mode = !in_pres_mode;
  for (var sid of paging_ids) {
    var section = document.getElementById(sid);
    if (section.id == 'body') {
      // skip; not actually a section.
    } else {
      section.style['margin'] = in_pres_mode ? '100vh 0 0 0' : '0';
    }
  }
  var footer = document.getElementById('footer');
  footer.style['margin'] = in_pres_mode ? '100vh 0 0 0' : '0';
}

var section_ids = null;
var paging_ids = null;
var paging_idx = 0;

window.onkeydown = function(e) {
  if (e.keyCode === 37) { // left.
    if (paging_idx > 0) {
      paging_idx -= 1;
    }
    scrollToElementId(paging_ids[paging_idx]);
  } else if (e.keyCode === 39) { // right.
    if (paging_idx < paging_ids.length - 1) {
      paging_idx += 1;
    }
    scrollToElementId(paging_ids[paging_idx]);
  }
};

window.onkeypress = function(e) {
  if (e.charCode === 112) { // 'p'.
    togglePresentationMode();
  }
};
</script>
</head>
<body id="body">
<section class="S1" id="s1">
  <h1 id="h1">Muck</h1>
  <p>
    Muck is a build tool for data projects. Given a target (a file to be built), it looks in the current directory tree for a source file with a matching name, determines its dependencies, recursively builds those, and then builds the target. Unlike Make and other traditional build systems, Muck does not use a "makefile". Instead, Muck determines the dependencies of a given file by analyzing its contents.

  </p>
  <p>
    With Muck, programmers can organize projects into discrete steps with arbitrary dependencies between them. When the source code for a particular step changes, Muck will rebuild that step and all dependent ("downstream") steps, but will not redo any work that is not affected by the change. This incremental rebuild behavior can speed up the development process dramatically, and helps prevent errors due to stale product files getting used by accident.

  </p>
  <p>
    The project is hosted at <a href=https:github.com/gwk/muck>https:github.com/gwk/muck</a>, with documentation at <a href=https:gwk.github.io/muck>https:gwk.github.io/muck</a>.

  </p>
  <p>
    The development of this project is sponsored by the <a href=https:towcenter.org>Tow Center for Digital Journalism</a>.

  </p>
  <p>
    Muck is limited to source languages that it understands, and to source code written using Muck conventions. In particular, Muck provides a few functions that scripts must use to make data dependencies explicit to the analyzer.

  </p>
  <p>
    By choosing sensible names for each step, the programmer can make the purpose of each step clear. Muck can print the entire dependency graph of the project, resulting in a precise, high-level description of how the code is organized.

  </p>
  <p>
    Muck is a good choice for projects where the products can be given descriptive, discrete names.

  </p>
</section>
<section class="S1" id="s2">
  <h1 id="h2">Installation</h1>
  <section class="S2" id="s2.1">
    <h2 id="h2.1">Python 3.6</h2>
    <p>
      Muck requires Python 3.6. (In the future it will support running project scripts in any available version).

    </p>
    <ul class="L1">
      <li>macOS: install from http://python.org, or perhaps use Homebrew.</li>
      <li>Ubuntu:</li>
      <ul class="L2">
        <li><code>$&nbsp;sudo&nbsp;apt-get&nbsp;python3.6</code></li>
        <li>For versions of Ubuntu that do not ship with a Python 3.6 package, use Felix Krull's <a href=https://launchpad.net/~fkrull/+archive/ubuntu/deadsnakes>deadsnakes</a> PPA (personal package archive):</li>
      </ul>
    </ul>
<pre>
$ sudo add-apt-repository ppa:fkrull/deadsnakes
$ sudo apt-get update
$ sudo apt-get install python3.6</pre>
    <p>
      For more information, see: <a href=http://askubuntu.com/questions/682869/how-do-i-install-newer-python-versions-using-apt-get>http://askubuntu.com/questions/682869/how-do-i-install-newer-python-versions-using-apt-get</a>

    </p>
  </section>
  <section class="S2" id="s2.2">
    <h2 id="h2.2">Pip</h2>
    <p>
      Muck should be installable with a single command: <code>pip3&nbsp;install&nbsp;muck</code>. Once installed, it should be available on the command line. If it is not, it may be that the <code>PATH</code> environment variable in your shell is not configured to point to console scripts installed by pip.

    </p>
  </section>
  <section class="S2" id="s2.3">
    <h2 id="h2.3">Development</h2>
    <p>
      See <a href=docs/dev-setup.html>dev-setup</a>.

    </p>
  </section>
</section>
<section class="S1" id="s3">
  <h1 id="h3">Usage</h1>
  <p>
    <code>muck</code> takes a list of targets as command line arguments. If no targets are provided it defaults to <code>index.html</code>.

  <br />
    Given a target <code>dir/stem.ext</code>, muck tries to produce the target file using the following steps:

  </p>
  <ul class="L1">
    <li>If the target exists as named, then it does nothing.</li>
    <li>If a source file exists that begins with the whole target name, e.g. <code>dir/stem.ext.py</code>, then that file is executed and its standard output is written to <code>_build/dir/stem.ext</code>.</li>
    <li>Otherwise Muck issues an error.</li>
  </ul>
  <p>
    When a script is run, it is first analyzed by Muck for any dependencies, which will be built before running the script. Dependency analysis is limited to the conventions that Muck understands.

  </p>
</section>
<section class="S1" id="s4">
  <h1 id="h4">An Example</h1>
  <p>
    Suppose we want to produce a document that contains two charts, A and B. Each of these is derived from some data that we scrape from the web. A typical Muck project to achieve this would consist of four files:

  </p>
  <ul class="L1">
    <li><code>document.html.wu</code>, referencing <code>chartA.svg</code> and <code>chartB.svg</code>.</li>
    <li><code>chartA.svg.py</code>, referencing <code>data.csv</code>.</li>
    <li><code>chartB.svg.py</code>, referencing <code>data.csv</code>.</li>
    <li><code>data.csv.py</code>.</li>
  </ul>
  <p>
    This project has a dependency graph whose shape is essentially a diamond, with <code>document.html</code> at the root, and <code>data.csv.py</code> having no dependencies.

  </p>
  <p>
    The programmer can build the document by invoking <code>muck&nbsp;document.html</code> on the command line. Muck will then take the following steps:

  </p>
  <ul class="L1">
    <li><code>document.html</code>: does not exist; infer source: <code>document.html.wu</code>.</li>
    <li><code>document.html.wu</code>: analyze, discover dependencies: <code>chartA.svg</code>, <code>chartB.svg</code>.</li>
    <li><code>chartA.svg</code>: does not exist; infer source: <code>chartA.svg.py</code>.</li>
    <li><code>chartA.svg.py</code>: analyze, discover dependencies: <code>data.csv</code>.</li>
    <li><code>data.csv</code>: does not exist; infer source: <code>data.csv.py</code>.</li>
    <li><code>data.csv.py</code>:</li>
    <ul class="L2">
      <li>analyze; no dependencies.</li>
      <li>run <code>python3&nbsp;data.csv.py</code>, writing stdout to <code>_build/data.csv</code>.</li>
    </ul>
    <li><code>chartA.svg.py</code>:</li>
    <ul class="L2">
      <li>run <code>python3&nbsp;chartA.svg.py</code>, which reads <code>_build/data.csv</code> and writes stdout to <code>_build/chartA.svg</code>.</li>
    </ul>
    <li><code>chartB.svg</code>: does not exist; infer source: <code>chartB.svg.py</code>.</li>
    <li><code>chartB.svg.py</code>:</li>
    <ul class="L2">
      <li>analyze, discover dependencies: <code>data.csv</code>.</li>
      <li>run <code>python3&nbsp;chartB.svg.py</code>, which reads <code>_build/data.csv</code> and writes stdout to <code>_build/chartB.svg</code>.</li>
    </ul>
    <li><code>document.html</code>:</li>
    <ul class="L2">
      <li>run <code>writeup&nbsp;document.html.wu</code>, which reads <code>_build/chartA.svg</code>, <code>_build/chartB.svg</code>, and writes <code>_build/document.html</code>.</li>
    </ul>
  </ul>
</section>
<footer id="footer">
Dedicated to the public domain under CC0: https://creativecommons.org/publicdomain/zero/1.0/.
</footer>
<script type="text/javascript"> "use strict";
section_ids = ['s1','s2','s2.1','s2.2','s2.3','s3','s4'];
paging_ids = ['body', 's1','s2','s2.1','s2.2','s2.3','s3','s4'];
</script>
</body>
</html>
